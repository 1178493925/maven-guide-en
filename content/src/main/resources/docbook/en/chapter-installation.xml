<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE chapter PUBLIC "-//OASIS//DTD DocBook XML V4.5//EN"
"http://www.oasis-open.org/docbook/xml/4.5/docbookx.dtd">
<chapter id="installation">
  <title>Installing and Running Maven</title>

  <para>This chapter contains very detailed instructions for installing Maven
  on a number of different platforms. Instead of assuming a level of
  familiarity with installing software and setting environment variables,
  we've opted to be as thorough as possible to minimize any problems that
  might arise do to a partial installation. The only thing this chapter
  assumes is that you've already installed a suitable Java Development Kit
  (<acronym>JDK</acronym>). If you are just interested in installation, you
  can move on to the rest of the book after reading through <xref
  linkend="section-maven-download" xrefstyle="select: title" /> and <xref
  linkend="section-maven-install" xrefstyle="select: title" />. If you are
  interested in the details of your Maven installation, this entire chapter
  will give you an overview of what you've installed and the meaning of the
  Apache Software License, Version 2.0.</para>

  <section id="section-installation-java">
    <title>Verify your Java Installation</title>

    <para>While Maven can run on Java 1.4, this book assumes that you are
    running at least Java 5. Go with the most recent stable Java Development
    Kit (<acronym>JDK</acronym>) available for your operating system. Either
    Java 5 or Java 6 will work with all of the examples in this book.</para>

    <para><screen><prompt moreinfo="none">% </prompt><command moreinfo="none">java -version</command>
java version "1.6.0_02"
Java(TM) SE Runtime Environment (build 1.6.0_02-b06)
Java HotSpot(TM) Client VM (build 1.6.0_02-b06, mixed mode, sharing)</screen></para>

    <para>Maven works with all certified Java<superscript>TM</superscript>
    compatible development kits, and a few non-certified implementations of
    Java. The examples in this book were written and tested against the
    official Java Development Kit releases downloaded from the Sun
    Microsystems web site. If you’re working with a Linux distribution, you
    may need to download Sun’s <acronym>JDK</acronym> yourself and make sure
    it’s the version you’re invoking (by running <command>java
    -version</command>). Now that Sun has open-sourced Java, this will
    hopefully improve in the future, and we’ll get the Sun
    <acronym>JRE</acronym> and <acronym>JDK</acronym> by default even in
    purist Linux distributions. Until that day, you may need to do some of
    your own downloading.</para>
  </section>

  <section id="section-maven-download">
    <title>Downloading Maven</title>

    <para>You can download Maven from the Apache Maven project website at
    <ulink
    url="http://maven.apache.org/download.html">http://maven.apache.org/download.html</ulink>.</para>

    <para>When downloading Maven, make sure you choose the latest version of
    Apache Maven from the Maven website. The latest version of Maven when this
    book was written was Maven 2.0.9. If you are not familiar with the Apache
    Software License, you should familiarize yourself with the terms of the
    license before you start using the product. More information on the Apache
    Software License can be found in <xref
    linkend="section-installation-license" />.</para>
  </section>

  <section id="section-maven-install">
    <title>Installing Maven</title>

    <para>There are wide differences between operating systems like Mac
    <acronym>OSX</acronym> and Microsoft Windows, and there are subtle
    differences between different versions of Windows. Luckily, the process
    for installing Maven on all of these operating systems is relatively
    painless and straightforward. The following sections outline the
    recommended best-practice for installing Maven on a variety of operating
    systems.</para>

    <section id="section-installation-maven-osx">
      <title>Installing Maven on Mac OSX</title>

      <para>You can download a binary release of Maven from <ulink
      url="http://maven.apache.org/download.html"><uri>http://maven.apache.org/download.html</uri></ulink>.
      Download the current release of Maven in a format that is convenient for
      you to work with. Pick an appropriate place for it to live, and expand
      the archive there. If you expanded the archive into the directory
      <filename moreinfo="none">/usr/local/maven-2.0.9</filename>; you may
      want to create a symbolic link to make it easier to work with and to
      avoid the need to change any environment configuration when you upgrade
      to a newer version</para>

      <screen>/usr/local % <command moreinfo="none">ln -s maven-2.0.9 maven
</command>/usr/local % <command>export M2_HOME=/usr/local/maven</command>
/usr/local % <command>export PATH=${M2_HOME}/bin:${PATH}</command></screen>

      <para>Once Maven is installed, you need to do a couple of things to make
      it work correctly. You need to add its <filename
      moreinfo="none">bin</filename> directory in the distribution (in this
      example, <filename moreinfo="none">/usr/local/maven/bin</filename>) to
      your command path. You also need to set the environment variable
      <varname>M2_HOME</varname> to the top-level directory you installed (in
      this example, <filename
      moreinfo="none">/usr/local/maven</filename>).</para>

      <note>
        <para>Installation instructions are the same for both
        <acronym>OSX</acronym> Tiger and <acronym>OSX</acronym> Leopard. It
        has been reported that Maven 2.0.6 is shipping with a preview release
        of XCode. If you have installed XCode, run <command>mvn</command> from
        the command-line to check availability. XCode installs Maven in
        <filename>/usr/share/maven</filename>. We recommend installing the
        most recent version of Maven 2.0.9 as there have been a number of bug
        fixes and improvements since Maven 2.0.9 was released.</para>
      </note>

      <para>You'll need to add both <envar>M2_HOME</envar> and
      <envar>PATH</envar> to a script that will run every time you login. To
      do this, add the following lines to
      <filename>.bash_login</filename>.</para>

      <programlisting>export M2_HOME=/usr/local/maven
export PATH=${M2_HOME}/bin:${PATH}</programlisting>

      <para>Once you've added these lines to your own environment, you will be
      able to run Maven from the command-line.</para>

      <note>
        <para>These installation instructions assume that you are running
        bash.</para>
      </note>
    </section>

    <section>
      <title>Installing Maven on Microsoft Windows</title>

      <para>Installing Maven on Windows is very similar to installing Maven on
      Mac <acronym>OSX</acronym>, the main differences being the installation
      location and the setting of an environment variable. This book assumes a
      Maven installation directory of <filename>c:\Program
      Files\maven-2.0.9</filename>, but it won't make a difference if you
      install Maven in another directory as long as you configure the proper
      environment variables. Once you've unpacked Maven to the installation
      directory, you will need to set two environment
      variables—<envar>PATH</envar> and <envar>M2_HOME</envar>. To set these
      environment variables from the command-line, type in the following
      commands:</para>

      <screen>C:\Users\tobrien &gt; <command>set M2_HOME=c:\Program Files\maven-2.0.9</command>
C:\Users\tobrien &gt; <command>set PATH=%PATH%;%M2_HOME%\bin</command></screen>

      <para>Setting these environment variables on the command-line will allow
      you to run Maven in your current session, but unless you add them to the
      System environment variables through the control panel, you'll have to
      execute these two lines every time you log into your system. You should
      modify both of these variables through the Control Panel in Microsoft
      Windows.<!--TODO: Document process of setting environment variables in the window control panel system dialog.--></para>
    </section>

    <section id="section-installation-maven-linux">
      <title>Installing Maven on Linux</title>

      <para>To install Maven on a Linux machine follow the exact procedure
      outlined in <xref linkend="section-installation-maven-osx" />.</para>
    </section>

    <section>
      <title>Installing Maven on FreeBSD or OpenBSD</title>

      <para>To install Maven on a FreeBSD or OpenBSD machine, follow the exact
      procedure outlined in <xref
      linkend="section-installation-maven-osx" />.</para>
    </section>
  </section>

  <section id="section-installation-test-install">
    <title>Testing a Maven Installation</title>

    <para>Once Maven is installed, you can check the version by running
    <command>mvn -v</command> from the command-line. If Maven has been
    installed, you should see something resembling the following
    output.</para>

    <screen>$ <command>mvn -v</command>
Maven 2.0.9</screen>

    <para>If you see this output, you know that Maven is available and ready
    to be used. If you do not see this output, and your operating system
    cannot find the <command>mvn</command> command, make sure that your
    <envar>PATH</envar> environment variable and <envar>M2_HOME</envar>
    environment variable have been properly set.</para>
  </section>

  <section id="section-installation-details">
    <title>Maven Installation Details</title>

    <para>Maven's download measures in at roughly 1.5 MiB<footnoteref
    linkend="foot-installation-mebibytes" />, it has attained such a slim
    download size because the core of Maven has been designed to retrieve
    plugins and dependencies from a remote repository on-demand. When you
    start using Maven, it will start to download plugins to a local repository
    described in <xref linkend="section-installation-user" />. In case you are
    curious, let's take a quick look at what is in Maven's installation
    directory.<footnote id="foot-installation-mebibytes">
        <para>Ever purchased a 200 GB hard drive only to realize that it
        showed up as less than 200 GiB when you installed it? Computers
        understand Gibibytes, but retailers sell products using Gigabytes. MiB
        stands for Mebibyte which is defined as 2<superscript>20</superscript>
        or 1024<superscript>2</superscript>. These binary prefix standards are
        endorsed by the <acronym>IEEE</acronym>, <acronym>CIPM</acronym>, and
        and <acronym>IEC</acronym>. For more information about Kibibytes,
        Mebibytes, Gibibytes, and Tebibytes see <ulink
        url="http://en.wikipedia.org/wiki/Mebibyte">http://en.wikipedia.org/wiki/Mebibyte</ulink>,</para>
      </footnote></para>

    <screen>/usr/local/maven $ <command>ls -p1</command>
LICENSE.txt
NOTICE.txt
README.txt
bin/
boot/
conf/
lib/</screen>

    <para>The <filename>LICENSE.txt</filename> contains the software license
    for Apache Maven. This license is described in some detail in <xref
    linkend="section-installation-license" />. <filename>NOTICE.txt</filename>
    contains some notices and attributions required by libraries that Maven
    depends upon. <filename>README.txt</filename> contains some installation
    instructions. <filename>bin/</filename> contains the
    <filename>mvn</filename> script that executes Maven.
    <filename>boot/</filename> contains a <acronym>JAR</acronym> file
    (<filename>classwords-1.1.jar</filename>) which is responsible for
    creating the classloader in which Maven executes.
    <filename>conf/</filename> contains a global
    <filename>settings.xml</filename> that can be used to customize the
    behavior of you Maven installation. If you need to customize Maven, it is
    customary to override any settings in a <filename>settings.xml</filename>
    file stored in <filename>~/.m2</filename>. <filename>lib/</filename>
    contains a single <acronym>JAR</acronym> file
    (<filename>maven-2.0.9-uber.jar</filename>) which contains the core of
    Maven.</para>

    <section id="section-installation-user">
      <title>User-specific Configuration and Repository</title>

      <para>Once you start using Maven extensively, you'll notice that Maven
      has created some local user-specific configuration files and a local
      repository in your home directory. In <filename>~/.m2</filename> there
      will be:</para>

      <variablelist>
        <varlistentry>
          <term>~/.m2/settings.xml</term>

          <listitem>
            <para>A file containing user-specific configuration for
            authentication, repositories, and other information to customize
            the behavior of Maven.</para>
          </listitem>
        </varlistentry>

        <varlistentry>
          <term>~/.m2/repository/</term>

          <listitem>
            <para>This directory contains your local Maven repository. When
            you download a dependency from a remote Maven repository, Maven
            stores a copy of the dependency in your local repository.</para>
          </listitem>
        </varlistentry>
      </variablelist>

      <note>
        <para>In Unix (and OSX), your home directory will be referred to using
        a tilde (i.e. <filename>~/bin</filename> refers to
        <filename>/home/tobrien/bin</filename>). In Windows, we will also be
        using <filename>~</filename> to refer to your home directory. In
        Windows XP, your home directory is <filename>C:\Documents and
        Settings\tobrien</filename>, and in Windows Vista, your home directory
        is <filename>C:\Users\tobrien</filename>. From this point forward, you
        should translate paths such as <filename>~/m2</filename> to your
        operating system's equivalent.</para>
      </note>
    </section>

    <section id="section-installation-upgrade">
      <title>Upgrading a Maven Installation</title>

      <para>If you've installed Maven on a Mac OSX or Unix machine according
      to the details in <xref lang=""
      linkend="section-installation-maven-osx" /> and <xref
      linkend="section-installation-maven-linux" />. It should be easy to
      upgrade to newer versions of Maven when they become available. Simply
      install the newer version of Maven
      (<filename>/usr/local/maven-2.future</filename>) next to the existing
      version of Maven (<filename>/usr/local/maven-2.0.9</filename>). Then
      switch the symbolic link <filename>/usr/local/maven</filename> from
      <filename>/usr/local/maven-2.0.9</filename> to
      <filename>/usr/local/maven-2.future</filename>. Since, you've already
      set your <varname>M2_HOME</varname> variable to point to
      <filename>/usr/local/maven</filename>, you won't need to change any
      environment variables.</para>

      <para>If you have installed Maven on a Windows machine, simply unpack
      Maven to <filename>c:\Program Files\maven-2.future</filename> and update
      your <varname>M2_HOME</varname> variable.</para>
    </section>
  </section>

  <section>
    <title>Getting Help with Maven</title>

    <para>While this book aims to be a comprehensive reference, there are
    going to be topics we will miss and special situations and tips which are
    not covered. While the core of Maven is very simple, the real work in
    Maven happens in the plugins, and there are too many plugins available to
    cover them all in one book. You are going to encounter problems and
    features which have not been covered in this book; in these cases, we
    suggest searching for answers at the following locations:</para>

    <variablelist>
      <varlistentry>
        <term><ulink
        url="http://maven.apache.org">http://maven.apache.org</ulink></term>

        <listitem>
          <para>This will be the first place to look, the Maven web site
          contains a wealth of information and documentation. Every plugin has
          a few pages of documentation and there are a series of "quick start"
          documents which will be helpful in addition to the content of this
          book. While the Maven site contains a wealth of information, it can
          also be a frustrating, confusing, and overwhelming. There is a
          custom Google search box on the main Maven page that will search
          known Maven sites for information. This provides better results than
          a generic Google search.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>Maven User Mailing List</term>

        <listitem>
          <para>The Maven User mailing list is the place for users to ask
          questions. Before you ask a question on the user mailing list, you
          will want to search for any previous discussion that might relate to
          your question. It is bad form to ask a question that has already
          been asked without first checking to see if an answer already exists
          in the archives. There are a number of useful mailing list archive
          browsers, we've found Nabble to the be the most useful. You can
          browse the User mailing list archives here: <ulink
          url="http://www.nabble.com/Maven---Users-f178.html">http://www.nabble.com/Maven---Users-f178.html</ulink>.
          You can join the user mailing list by following the instructions
          available here <ulink
          url="http://maven.apache.org/mail-lists.html">http://maven.apache.org/mail-lists.html</ulink>.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term><ulink
        url="http://www.sonatype.com">http://www.sonatype.com</ulink></term>

        <listitem>
          <para>Sonatype maintains an online copy of this book and other
          tutorials related to Apache Maven. </para>
        </listitem>
      </varlistentry>
    </variablelist>

    <note>
      <para>Despite the best efforts of some very dedicated Maven
      contributors, the Maven web site is poorly organized and full of
      incomplete (and sometimes) misleading snippets of documentation.
      Throughout the Maven community there is a lack of a common standards for
      plugin documentation, some plugins are heavily documented while others
      lack even the most basic instructions for usage. Often your best bet is
      to search for a solution in the archives of the user mailing list. If
      you really want to help submit a patch to the Maven site (or this
      book).</para>
    </note>
  </section>

  <section id="sect-help-plugin-install">
    <title>Using the Maven Help Plugin</title>

    <para>Throughout the book, we will be introducing Maven plugins, talking
    about Maven Project Object Model (<acronym>POM</acronym>) files, settings
    files, and profiles. There are going to be times when you need a tool to
    help you make sense of some of the models that Maven is using and what
    goals are available on a specific plugin. The Maven Help plugin allows you
    to list active Maven profiles, display an effective
    <acronym>POM</acronym>, print the effective settings, or list the
    attributes of a Maven plugin.</para>

    <note>
      <para>For a conceptual overview of the POM and plugins see Chapter <xref
      linkend="simple-project" xrefstyle="style:title" />.</para>
    </note>

    <para>The Maven Help plugin has four goals. The first three
    goals—<varname>active-profiles</varname>,
    <varname>effective-pom</varname>, and
    <varname>effective-settings</varname>—describe a particular project and
    must be run in the base directory of a project. The last
    goal—<varname>describe</varname>—is slightly more complex, showing you
    information about a plugin or a plugin goal.</para>

    <variablelist>
      <varlistentry>
        <term>help:active-profiles</term>

        <listitem>
          <para>Lists the profiles (project, user, global) which are active
          for the build.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>help:effective-pom</term>

        <listitem>
          <para>Displays the effective <acronym>POM</acronym> for the current
          build, with the active profiles factored in.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>help:effective-settings</term>

        <listitem>
          <para>Prints out the calculated settings for the project, given any
          profile enhancement and the inheritance of the global settings into
          the user-level settings.</para>
        </listitem>
      </varlistentry>

      <varlistentry>
        <term>help:describe</term>

        <listitem>
          <para>Describes the attributes of a plugin. This need not run under
          an existing project directory. You must at least give the
          <varname>groupId</varname> and <varname>artifactId</varname> of the
          plugin you wish to describe.</para>
        </listitem>
      </varlistentry>
    </variablelist>

    <section>
      <title>Describing a Maven Plugin</title>

      <para>Once you start using Maven, you'll spend most of your time trying
      to get more information about Maven Plugins: How do plugins work? What
      are the configuration parameters? What are the goals? The
      <varname>help:describe</varname> goal is something you'll be using very
      frequently to retrieve this information. With the
      <varname>plugin</varname> parameter you can specify a plugin you wish to
      investigate, passing in either the plugin prefix (e.g.
      <varname>maven-help-plugin</varname> as <varname>help</varname>) or the
      <varname>groupId:artifact[:version]</varname>, where version is
      optional. For example, the following command uses the Help plugin's
      <varname>describe</varname> goal to print out information about the
      Maven Help plugin.</para>

      <screen>$ <command>mvn help:describe -Dplugin=help</command>
...
Group Id:  org.apache.maven.plugins
Artifact Id: maven-help-plugin
Version:     2.0.1
Goal Prefix: help
Description:

The Maven Help plugin provides goals aimed at helping to make sense out of
    the build environment. It includes the ability to view the effective
    POM and settings files, after inheritance and active profiles
    have been applied, as well as a describe a particular plugin goal to give 
    usage information.
...
</screen>

      <para>Executing the <varname>describe</varname> goal with the
      <varname>plugin</varname> parameter printed out the Maven coordinates
      for the plugin, the goal prefix, and a brief description of the plugin.
      While this information is helpful, you'll usually be looking for more
      detail than this. If you want the Help plugin to print a full list of
      goals with parameters, execute the <varname>help:describe</varname> goal
      with the parameter <varname>full</varname> as follows:</para>

      <screen>$ <command>mvn help:describe -Dplugin=help -Dfull</command>
...
Group Id:  org.apache.maven.plugins
Artifact Id: maven-help-plugin
Version:     2.0.1
Goal Prefix: help
Description:

The Maven Help plugin provides goals aimed at helping to make sense out of
    the build environment. It includes the ability to view the effective
    POM and settings files, after inheritance and active profiles
    have been applied, as well as a describe a particular plugin goal to 
    give usage information.

Mojos:

===============================================
Goal: 'active-profiles'
===============================================
Description:

Lists the profiles which are currently active for this build.

Implementation: org.apache.maven.plugins.help.ActiveProfilesMojo
Language: java

Parameters:
-----------------------------------------------

[0] Name: output
Type: java.io.File
Required: false
Directly editable: true
Description:

This is an optional parameter for a file destination for the output of 
this mojo...the listing of active profiles per project.

-----------------------------------------------

[1] Name: projects
Type: java.util.List
Required: true
Directly editable: false
Description:

This is the list of projects currently slated to be built by Maven.

-----------------------------------------------

This mojo doesn't have any component requirements.
===============================================

... removed the other goals ...
</screen>

      <para>This option is great for discovering all of a plugin's goals as
      well as their parameters. But sometimes this is far more information
      than necessary. To get information about a single goal, set the
      <varname>mojo</varname> parameter as well as the
      <varname>plugin</varname> parameter. The following command lists all of
      the information about the Compiler plugin's <varname>compile</varname>
      goal.</para>

      <screen>$ <command>mvn help:describe -Dplugin=compiler -Dmojo=compile -Dfull</command></screen>

      <note>
        <para>What? A Mojo? In Maven, a Plugin goal is known as a
        "Mojo".</para>
      </note>
    </section>
  </section>

  <section id="section-installation-license">
    <title>About the Apache Software License</title>

    <para>Apache Maven is released under the Apache Software License, Version
    2.0. If you want to read this license, you can read
    <filename>${M2_HOME}/LICENSE.txt</filename> or read this license on the
    Open Source Initiative's web site here <ulink
    url="http://www.opensource.org/licenses/apache2.0.php">http://www.opensource.org/licenses/apache2.0.php</ulink>.</para>

    <para>There's a good chance that, if you are reading this book, you are
    not a lawyer. If you are wondering what the Apache License, Version 2.0
    means, the Apache Software Foundation has assembled a very helpful
    Frequently Asked Questions (FAQ) page about the license available here
    <ulink
    url="http://www.apache.org/foundation/licence-FAQ.html">http://www.apache.org/foundation/licence-FAQ.html</ulink>.
    Here's is the answer to the question "I am not a lawyer. What does it all
    mean?"</para>

    <para><blockquote>
        <para><emphasis>It allows you to:</emphasis></para>

        <itemizedlist>
          <listitem>
            <para>freely download and use Apache software, in whole or in
            part, for personal, company internal, or commercial
            purposes;</para>
          </listitem>

          <listitem>
            <para>use Apache software in packages or distributions that you
            create.</para>
          </listitem>
        </itemizedlist>

        <para><emphasis>It forbids you to:</emphasis></para>

        <itemizedlist>
          <listitem>
            <para>redistribute any piece of Apache-originated software without
            proper attribution;</para>
          </listitem>

          <listitem>
            <para>use any marks owned by The Apache Software Foundation in any
            way that might state or imply that the Foundation endorses your
            distribution;</para>
          </listitem>

          <listitem>
            <para>use any marks owned by The Apache Software Foundation in any
            way that might state or imply that you created the Apache software
            in question.</para>
          </listitem>
        </itemizedlist>

        <para><emphasis>It requires you to:</emphasis></para>

        <itemizedlist>
          <listitem>
            <para>include a copy of the license in any redistribution you may
            make that includes Apache software;</para>
          </listitem>

          <listitem>
            <para>provide clear attribution to The Apache Software Foundation
            for any distributions that include Apache software.</para>
          </listitem>
        </itemizedlist>

        <para><emphasis>It does not require you to:</emphasis></para>

        <itemizedlist>
          <listitem>
            <para>include the source of the Apache software itself, or of any
            modifications you may have made to it, in any redistribution you
            may assemble that includes it;</para>
          </listitem>

          <listitem>
            <para>submit changes that you make to the software back to the
            Apache Software Foundation (though such feedback is
            encouraged).</para>
          </listitem>
        </itemizedlist>
      </blockquote></para>
  </section>
</chapter>
